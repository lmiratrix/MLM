{"title":"Within, Between, and Contextual Effects","markdown":{"yaml":{"title":"Within, Between, and Contextual Effects","author":"Josh Gilbert","editor":{"markdown":{"wrap":"sentence"}}},"headingText":"load libraries","containsRefs":false,"markdown":"\n\n```{r, echo = FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(warning = FALSE)\nknitr::opts_chunk$set(message = FALSE)\n```\n\nMany find it hard to keep track of within, between, and contextual effects in MLMs.\nThis short walkthrough shows how to fit and interpret each model using the HSB data.\n\n```{r}\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(sjPlot)\nlibrary(ggeffects)\nlibrary(haven)\n\n# clear memory\nrm(list = ls())\n\nselect <- dplyr::select\n\n# load HSB data\nhsb <- read_dta(\"data/hsb.dta\") |> \n  select(mathach, ses, schoolid) |> \n  group_by(schoolid) |> \n  mutate(grp_mean_ses = mean(ses)) |> \n  ungroup() |> \n  mutate(grp_center_ses = ses - grp_mean_ses)\n```\n\n## Fitting the Models\n\n```{r}\nols <- lm(mathach ~ ses, hsb)\nfe <- lm(mathach ~ ses + factor(schoolid), hsb)\nri <- lmer(mathach ~ ses + (1|schoolid), hsb)\nri_within <- lmer(mathach ~ grp_center_ses + (1|schoolid), hsb)\nri_between <- lmer(mathach ~ grp_mean_ses + (1|schoolid), hsb)\nre_wb <- lmer(mathach ~ grp_center_ses + grp_mean_ses + (1|schoolid), hsb)\ncontextual <- lmer(mathach ~ ses + grp_mean_ses + (1|schoolid), hsb)\n\ntab_model(ols, fe, ri, ri_within, ri_between, re_wb, contextual,\n          p.style = \"stars\",\n          show.ci = FALSE,\n          show.se = TRUE,\n          keep = \"ses\",\n          show.dev = TRUE,\n          dv.labels = c(\"OLS\",\n                        \"Fixed Effects\",\n                        \"Rand. Int.\",\n                        \"RI Within\",\n                        \"RI Between\",\n                        \"REWB\",\n                        \"Mundlak\"))\n```\n\n## Interpretation\n\n### OLS\n\n```{r,echo=FALSE}\nols$call\n```\n\nIgnoring school membership, students who are 1-unit higher in SES are predicted to score 3.18 points higher in math.\nThis is generally not a preferred model.\n\n### Fixed Effects\n\n```{r,echo=FALSE}\nfe$call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math.\nFixed effects models focus on within-school comparisons: we are looking at how students within schools relate to each other, and then averaging this relationship across all our schools to get our final estimate.\n\n### Random Intercepts\n\n```{r,echo=FALSE}\nri@call\n```\n\nStudents who are 1-unit higher in SES are predicted to score 2.39 points higher in math; schools that are 1-unit higher in mean SES are predicted to have mean math scores 2.39 points higher.\n\nThe random intercept model gives a precision-weighted average of the within and between effects.\nLooking at the other models, note that our within effect is 2.19 and our between effect is 5.86.\nIf the RE assumption holds, these are the same in the population, so we get more precision by averaging them together.\nHowever, in social science, they are rarely the same, making this model provide a weird blend of two kinds of mechanism.\n\n### Random Intercepts, Within Effect\n\n```{r,echo=FALSE}\nri_within@call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math.\nThis is the same coefficient as the FE model, but in an RI framework.\nWe have \"controlled for school\" manually by demeaning the SES variable.\n\n### Random Intercepts, Between\n\n```{r,echo=FALSE}\nri_between@call\n```\n\nSchools that are 1-unit higher in mean SES are predicted to have mean math scores 5.86 points higher.\n\n### Random Effects within and Between\n\n```{r,echo=FALSE}\nre_wb@call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math; schools that are 1-unit higher in mean SES are predicted to have mean math scores 5.86 points higher.\nWe get the within and between effects in a single model!\n\n### Contextual/Mundlak\n\n```{r,echo=FALSE}\ncontextual@call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math; *holding constant student SES*, a student that attends a school with 1-unit higher in mean SES are predicted to have mean math scores 3.68 points higher.\nThe contextual effect is the *difference* in the within and between effects (note that 5.86 - 2.19 = 3.68, up to rounding), and, in principle, its significance test allows us to determine if having both is necessary.\nMathematically, the Mundlak model and REWB are *identical*, as you can see from the deviance statistics.\nYou would choose one over the other depending on your preferred interpretation.\n\n## Further Reading\n\n[@antonakis2019a]\n","srcMarkdownNoYaml":"\n\n```{r, echo = FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(warning = FALSE)\nknitr::opts_chunk$set(message = FALSE)\n```\n\nMany find it hard to keep track of within, between, and contextual effects in MLMs.\nThis short walkthrough shows how to fit and interpret each model using the HSB data.\n\n```{r}\n# load libraries\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(sjPlot)\nlibrary(ggeffects)\nlibrary(haven)\n\n# clear memory\nrm(list = ls())\n\nselect <- dplyr::select\n\n# load HSB data\nhsb <- read_dta(\"data/hsb.dta\") |> \n  select(mathach, ses, schoolid) |> \n  group_by(schoolid) |> \n  mutate(grp_mean_ses = mean(ses)) |> \n  ungroup() |> \n  mutate(grp_center_ses = ses - grp_mean_ses)\n```\n\n## Fitting the Models\n\n```{r}\nols <- lm(mathach ~ ses, hsb)\nfe <- lm(mathach ~ ses + factor(schoolid), hsb)\nri <- lmer(mathach ~ ses + (1|schoolid), hsb)\nri_within <- lmer(mathach ~ grp_center_ses + (1|schoolid), hsb)\nri_between <- lmer(mathach ~ grp_mean_ses + (1|schoolid), hsb)\nre_wb <- lmer(mathach ~ grp_center_ses + grp_mean_ses + (1|schoolid), hsb)\ncontextual <- lmer(mathach ~ ses + grp_mean_ses + (1|schoolid), hsb)\n\ntab_model(ols, fe, ri, ri_within, ri_between, re_wb, contextual,\n          p.style = \"stars\",\n          show.ci = FALSE,\n          show.se = TRUE,\n          keep = \"ses\",\n          show.dev = TRUE,\n          dv.labels = c(\"OLS\",\n                        \"Fixed Effects\",\n                        \"Rand. Int.\",\n                        \"RI Within\",\n                        \"RI Between\",\n                        \"REWB\",\n                        \"Mundlak\"))\n```\n\n## Interpretation\n\n### OLS\n\n```{r,echo=FALSE}\nols$call\n```\n\nIgnoring school membership, students who are 1-unit higher in SES are predicted to score 3.18 points higher in math.\nThis is generally not a preferred model.\n\n### Fixed Effects\n\n```{r,echo=FALSE}\nfe$call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math.\nFixed effects models focus on within-school comparisons: we are looking at how students within schools relate to each other, and then averaging this relationship across all our schools to get our final estimate.\n\n### Random Intercepts\n\n```{r,echo=FALSE}\nri@call\n```\n\nStudents who are 1-unit higher in SES are predicted to score 2.39 points higher in math; schools that are 1-unit higher in mean SES are predicted to have mean math scores 2.39 points higher.\n\nThe random intercept model gives a precision-weighted average of the within and between effects.\nLooking at the other models, note that our within effect is 2.19 and our between effect is 5.86.\nIf the RE assumption holds, these are the same in the population, so we get more precision by averaging them together.\nHowever, in social science, they are rarely the same, making this model provide a weird blend of two kinds of mechanism.\n\n### Random Intercepts, Within Effect\n\n```{r,echo=FALSE}\nri_within@call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math.\nThis is the same coefficient as the FE model, but in an RI framework.\nWe have \"controlled for school\" manually by demeaning the SES variable.\n\n### Random Intercepts, Between\n\n```{r,echo=FALSE}\nri_between@call\n```\n\nSchools that are 1-unit higher in mean SES are predicted to have mean math scores 5.86 points higher.\n\n### Random Effects within and Between\n\n```{r,echo=FALSE}\nre_wb@call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math; schools that are 1-unit higher in mean SES are predicted to have mean math scores 5.86 points higher.\nWe get the within and between effects in a single model!\n\n### Contextual/Mundlak\n\n```{r,echo=FALSE}\ncontextual@call\n```\n\nHolding constant school, students who are 1-unit higher in SES are predicted to score 2.19 points higher in math; *holding constant student SES*, a student that attends a school with 1-unit higher in mean SES are predicted to have mean math scores 3.68 points higher.\nThe contextual effect is the *difference* in the within and between effects (note that 5.86 - 2.19 = 3.68, up to rounding), and, in principle, its significance test allows us to determine if having both is necessary.\nMathematically, the Mundlak model and REWB are *identical*, as you can see from the deviance statistics.\nYou would choose one over the other depending on your preferred interpretation.\n\n## Further Reading\n\n[@antonakis2019a]\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"pygments","output-file":"within_v_between.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"theme":"cosmo","code-copy":true,"title":"Within, Between, and Contextual Effects","author":"Josh Gilbert"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","highlight-style":"pygments","output-file":"within_v_between.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"documentclass":"scrreprt","title":"Within, Between, and Contextual Effects","author":"Josh Gilbert"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}