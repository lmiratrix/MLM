{"title":"Likelihood Ratio Tests","markdown":{"yaml":{"title":"Likelihood Ratio Tests","author":"Josh Gilbert","editor":{"markdown":{"wrap":"sentence"}}},"headingText":"R Setup","containsRefs":false,"markdown":"\n\n```{r, echo = FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(warning = FALSE)\nknitr::opts_chunk$set(message = FALSE)\n```\n\n\n```{r}\n# load libraries\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(haven)\nlibrary(sjPlot)\n\n# clear memory\nrm(list = ls())\n\nselect <- dplyr::select\n\n# load HSB data\nhsb <- read_dta(\"data/hsb.dta\") |> \n  select(mathach, ses, schoolid)\n```\n\n## Why LR Tests?\n\nOur fixed effects coefficients have SEs, z-statistics, and p-values, which allow us to easily test the null hypothesis that the slopes are 0 in the population.\nNo such quantities, however, are provided for the random effects of our model.\nWe can use LR tests to address this issue and test the statistical significance of the various random portions of our model.\n\nWe can also use LR tests on fixed effects or sets of fixed effects (like a nested F-test in OLS), but 99.9% of the time, the conclusion will be the same as using the z-statistics.\n\nLR tests require that the models are *nested*, meaning that they use the same data, and one model can be expressed as a constrained version of the other.\n\n## HSB Example\n\nWe fit 3 models:\n\n1.  Random intercept model\n2.  Random slope model\n3.  Random slope model with no correlation between intercepts and slopes\n\nWe can see from the model output that the point estimates for the random slope variance $\\tau_{11}$ and the correlation $\\rho_{01}$ are non-zero, but how can we get p-values for these quantities?\n\n```{r}\nm1 <- lmer(mathach ~ ses + (1|schoolid), hsb)\nm2 <- lmer(mathach ~ ses + (ses|schoolid), hsb)\nm3 <- lmer(mathach ~ ses + (ses||schoolid), hsb)\n\ntab_model(m1, m2, m3,\n          p.style = \"stars\",\n          show.se = TRUE,\n          show.ci = FALSE,\n          dv.labels = c(\"RI\", \"RS\", \"No Rho\"))\n```\n\n### Are random `ses` slopes necessary?\n\nWe use `anova` to perform the LR test comparing `m1` and `m2`, and we see that the random slopes are not statistically significant.\n\n```{r}\nanova(m1, m2)\n```\n\n### Is there a correlation between the random intercept and slope for `ses`?\n\nSimilarly, we see that the correlation is non-significant\n\n```{r}\nanova(m2, m3)\n```\n\n## Technical Notes\n\nTL/DR: The traditional LR test provided by `anova` is likely to be conservative for testing the significance of variance components.\nFor the purposes of this course, it is fine.\n\nThere is a lot of multilevel literature arguing that testing a null hypothesis on variance components with LR tests is not the best approach.\nThe reason is that variances cannot be negative, so the null hypothesis exists on the \"boundary of the parameter space\" and therefore is \"likely to be conservative\" (to use the warning that Stata gives you, i.e., the p-values are too high).\nThe true distribution of a 0 variance component is not a normal distribution, but a mixture distribution with half of the probability mass at 0 and the other half $\\chi^2$.\nWhen you're testing the significance of the random intercepts model, you can divide the p-value by 2 to get the right answer (Stata default), though for more complex models it's not so simple.\nThere are some R packages that use simulation-based approaches to provide more robust results such as `pbkrtest::PBmodcomp`, but we won't go into them here.\nSee RH&S pp. 88-89 for a more thorough discussion of this issue.\nDespite this, the standard LR test remains common in practice.\n","srcMarkdownNoYaml":"\n\n```{r, echo = FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(warning = FALSE)\nknitr::opts_chunk$set(message = FALSE)\n```\n\n## R Setup\n\n```{r}\n# load libraries\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(haven)\nlibrary(sjPlot)\n\n# clear memory\nrm(list = ls())\n\nselect <- dplyr::select\n\n# load HSB data\nhsb <- read_dta(\"data/hsb.dta\") |> \n  select(mathach, ses, schoolid)\n```\n\n## Why LR Tests?\n\nOur fixed effects coefficients have SEs, z-statistics, and p-values, which allow us to easily test the null hypothesis that the slopes are 0 in the population.\nNo such quantities, however, are provided for the random effects of our model.\nWe can use LR tests to address this issue and test the statistical significance of the various random portions of our model.\n\nWe can also use LR tests on fixed effects or sets of fixed effects (like a nested F-test in OLS), but 99.9% of the time, the conclusion will be the same as using the z-statistics.\n\nLR tests require that the models are *nested*, meaning that they use the same data, and one model can be expressed as a constrained version of the other.\n\n## HSB Example\n\nWe fit 3 models:\n\n1.  Random intercept model\n2.  Random slope model\n3.  Random slope model with no correlation between intercepts and slopes\n\nWe can see from the model output that the point estimates for the random slope variance $\\tau_{11}$ and the correlation $\\rho_{01}$ are non-zero, but how can we get p-values for these quantities?\n\n```{r}\nm1 <- lmer(mathach ~ ses + (1|schoolid), hsb)\nm2 <- lmer(mathach ~ ses + (ses|schoolid), hsb)\nm3 <- lmer(mathach ~ ses + (ses||schoolid), hsb)\n\ntab_model(m1, m2, m3,\n          p.style = \"stars\",\n          show.se = TRUE,\n          show.ci = FALSE,\n          dv.labels = c(\"RI\", \"RS\", \"No Rho\"))\n```\n\n### Are random `ses` slopes necessary?\n\nWe use `anova` to perform the LR test comparing `m1` and `m2`, and we see that the random slopes are not statistically significant.\n\n```{r}\nanova(m1, m2)\n```\n\n### Is there a correlation between the random intercept and slope for `ses`?\n\nSimilarly, we see that the correlation is non-significant\n\n```{r}\nanova(m2, m3)\n```\n\n## Technical Notes\n\nTL/DR: The traditional LR test provided by `anova` is likely to be conservative for testing the significance of variance components.\nFor the purposes of this course, it is fine.\n\nThere is a lot of multilevel literature arguing that testing a null hypothesis on variance components with LR tests is not the best approach.\nThe reason is that variances cannot be negative, so the null hypothesis exists on the \"boundary of the parameter space\" and therefore is \"likely to be conservative\" (to use the warning that Stata gives you, i.e., the p-values are too high).\nThe true distribution of a 0 variance component is not a normal distribution, but a mixture distribution with half of the probability mass at 0 and the other half $\\chi^2$.\nWhen you're testing the significance of the random intercepts model, you can divide the p-value by 2 to get the right answer (Stata default), though for more complex models it's not so simple.\nThere are some R packages that use simulation-based approaches to provide more robust results such as `pbkrtest::PBmodcomp`, but we won't go into them here.\nSee RH&S pp. 88-89 for a more thorough discussion of this issue.\nDespite this, the standard LR test remains common in practice.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"pygments","output-file":"lr_test.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"theme":"cosmo","code-copy":true,"title":"Likelihood Ratio Tests","author":"Josh Gilbert"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","highlight-style":"pygments","output-file":"lr_test.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"documentclass":"scrreprt","title":"Likelihood Ratio Tests","author":"Josh Gilbert"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}