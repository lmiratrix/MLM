{"title":"Making Regression Tables","markdown":{"headingText":"Making Regression Tables","headingAttr":{"id":"sec-make-regression-tables","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r setup, include=FALSE, message=FALSE, warning=FALSE }\n\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(arm)\nlibrary(knitr)\nlibrary(texreg)\nlibrary(stargazer)\nlibrary(lmtest)\n\nopts_chunk$set(message=FALSE, warning=FALSE, tidy=FALSE, out.width=\"4.5in\")\n\n\n## read in data\ndat1 <- read.csv(\"data/MCC_students.csv\")\n#dat2 <- read.csv(\"MCC_schools.csv\")\n\n## keep relevant variables\nvars1 <- c(\"ID\", \"esafe\", \"grade\", \"gender\", \"disc\", \"race_white\")\n#vars2 <- c(\"ID\", \"mean.belong\")\n\ndat1 <- dplyr::select(dat1, vars1)\n#dat2 <- dplyr::select(dat2, vars2)\n\n## convert grade to numeric\ndat1$grade <- gsub(\"th\", \"\", dat1$grade) ## remove ’th’ with ’’ \ndat1$grade <- as.numeric(dat1$grade) ## convert from char to num\n\n## keep only observations who answered either male or female\ndat1 <- filter(dat1, gender %in% c(\"Female\", \"Male\"))\n\n## make race a factor variable\ndat1$race_white <- as.factor(dat1$race_white)\n\n## keep only complete cases\ndat1x <- dat1[complete.cases(dat1), ]\n#dat2x <- dat2[complete.cases(dat2), ]\n\n#rename dataset\ndat <- dat1x\n#dat <- merge(dat1x,dat2x,by= \"ID\")\n\nsch1 = filter( dat1x, ID == 1 )\nnrow( sch1 )\n\ndat = dat %>% group_by(ID) %>% \n  mutate(max.grade = max(grade), HS = max.grade >= 9)\ndat.g8 <- filter(dat, grade==8)\n\n```\n\nFor publication-ready tables and graphics, R has many wonderful packages to automate the process. Some of these packages are good for html documents (websites) and some are good for making PDF documents (reports and papers). This document demonstrates different ways of making regression tables in your reports, and talks about some weird wrinkles with using them with multilevel modeling.\n\n## The basics of regression tables\n\nFor the basics we quickly illustrate regression tables using a subset of the Making Caring Common dataset, which we will eventually discuss in class. This dataset has a measure of emotional safety (our outcome) and we want to see, in a specific school, if this is predicted by gender and/or grade.\n\nOur data look like this:\n\n```{r}\nsample_n( sch1, 6 )\n```\n\nWe fit some models:\n\n```{r}\nM_A = lm( esafe ~ grade, data = sch1 )\nM_B = lm( esafe ~ grade + gender, data = sch1 )\nM_C = lm( esafe ~ grade * gender, data = sch1 )\n```\n\nOk, we have fit our regression models. We can look at big complex printout of a single model like so:\n\n```{r}\nsummary( M_C )\n```\n\nOr we can make *regression tables*. Consider these two packages, the first being `texreg`\n\n```{r}\nlibrary( texreg )\nscreenreg(list(M_A, M_B, M_C))\n```\n\nAnother is `stargazer`.\n\n```{r}\nlibrary( stargazer )\nstargazer( M_A, M_B, M_C, header=FALSE, type='text')\n```\n\n## Extending to the multilevel model\n\nFor our multilevel examples, we use the Making Caring Common data from Project A, and fit data to the 8th grade students only, but do it for all schools. We have made a High School dummy variable.\n\nOur two models we use for demo purposes have a HS term and no HS term:\n\n```{r}\nmodA <- lmer( esafe ~ 1 + (1 | ID), data=dat.g8)\nmodB <- lmer( esafe ~ 1 + HS + (1 | ID), data=dat.g8)\n```\n\nIn the next sections we first show how to get better summary output (according to some folks) and then we walk through making regression tables in a bit more detail than above.\n\n## Getting p-values for lmer output\n\nThe `lmerTest` package is a way of making R give you more complete output. We are going to load it, and then put the new lmer models into new variables so we can see how the different model fitting packages work with the regression table packages below.\n\n```{r}\nlibrary( lmerTest )\nmodB.T <- lmer( esafe ~ 1 + HS + (1 | ID), data=dat.g8)\nmodA.T <- lmer( esafe ~ 1 + (1 | ID), data=dat.g8)\n\nsummary( modB.T )\n```\n\n## The texreg package\n\nIn `texreg` there are two primary functions for table making, one is `screenreg()` and the other is `texreg()`.\n\n### Using screenreg()\n\nScreenreg is fine for MLMs. It looks a bit like raw output, but it is clear and clean. It will take models fit using lmer or lmerTest, no problem.\n\n```{r}\nscreenreg(list(modA,modB))\n```\n\n*Comment:* Note that the number of stars are different for the display vs the summary output! (Look at the HS coefficient for example.) Not good, it would seem.\n\nThis is because the $p$-values are calculated using the normal approximation by the screenreg command, and using the $t$-test with approximate degrees of freedom by `lmerTest`. This makes a difference. Consider the following, using the $t$ statistics for the HS variable:\n\n```{r}\n2 * pt( -2.733, df=25.77814 )\n2 * pnorm( -2.733 )\n```\n\nOne is below 0.01, and one is not. An extra star!\n\n### Using texreg() and TeX\n\nThe `texreg` command is part of the `texreg` package and can be integrated with latex (which you would need to install). Once you do this, when you compile to a pdf, all is well. In the R code chunk you need to include `results=\"asis\"` to get the latex to compile right. E.g., \"`r, results=\"asis\"`\" when you declare a code chunk.\n\n```{r, results=\"asis\"}\ntexreg(list(modA,modB), table=FALSE)\n```\n\nNote that the `table=FALSE` puts the table right where you want it, not at some random spot latex things is nice. Latex likes to have \"floating tables,\" where it puts the table where there is space; this makes it easier to make the entire formatted page look nice.\n\n## The stargazer package\n\n```{r, results=\"asis\"}\nlibrary( stargazer )\nstargazer(modA, modB, header=FALSE, type='latex')\n```\n\nOne issue is stargazer does not include the random effect variances, so the output is quite limited for multilevel modeling. It also has less stringent conditions for when to put down stars. One star is below 0.10, two is below 0.05, and three is below 0.01. This is quite generous. Also it is using the normal approximation.\n\n### Stargazer with lmerTest\n\nStargazer with lmerTest is a bit fussy. This shows how to make it work if you have loaded the lmerTest package. Recall the lmerTest package makes your lmer commands have p-values and whatnot. But this means your new `lmer()` command is not quite the same as the old---and stargazer is expecting the old. You gix this by lying to R, telling it the new thing is the old thing. This basically works.\n\nNow for stargazer, we need to tell it that our models are the right type. First note:\n\n```{r}\nclass( modB )\nclass( modB.T)\n```\n\nSo we fix as follows:\n\n```{r, results=\"asis\"}\nlibrary( stargazer )\nclass( modB.T ) = \"lmerMod\" \nclass( modA.T ) = \"lmerMod\" \nstargazer(modA.T, modB.T, header=FALSE, type='latex' )\n```\n\n### The sjPlot package\n\nOne function, `tab_model` from `sjPlot`, makes nice regression tables:\n\n```{r}\n# tabulate the results of our two tip models\nlibrary( sjPlot )\ntab_model(modA.T, modB.T)\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"pygments","output-file":"reg_table_demo.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","bibliography":["references.bib"],"output_dir":"docs","editor":"visual","theme":"cosmo","code-copy":true},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","highlight-style":"pygments","output-file":"reg_table_demo.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"output_dir":"docs","editor":"visual","documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}