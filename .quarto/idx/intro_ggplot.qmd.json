{"title":"Intro to `ggplot`","markdown":{"yaml":{"title":"Intro to `ggplot`","author":"Luke Miratrix","editor":{"markdown":{"wrap":"sentence"}}},"headingText":"Summarizing","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nlibrary(lme4)\nlibrary(arm)\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(ggthemes)\n\nknitr::opts_chunk$set(echo = TRUE)\n```\n\nThis is a simple script demonstrating some powerful features of a plotting package `ggplot2`.\n\n`ggplot` can initially seem like a nightmare to some, but once you wrestle it to the ground it is one of the most powerful visualization tools you might have in your toolbox.\nHappily, it is fairly easy to get some basics up and running once you start looking at the world the way it does.\nLet's start doing that.\n\nFirst, `ggplot` thinks of a plot as a collection of layers stacked on top of each other.\nThe way this looks in code is a bunch of weird function calls connected together with `+`.\nYou read this series of calls left to right.\nThe first call is always a statement saying what data you are plotting and what variables you care about.\nSo before you can even plot, you need to make sure your data are in a nice, tidy data frame.\n\nHappily, when you load data, it usually is.\nFor example:\n\n```{r warning=FALSE}\ndat <- read_dta(\"data/hsb.dta\") |> \n  select(1:10)\n\nnames( dat )\n```\n\nThe easiest full plot to make has two elements.\nThe first gives what your variables are, and the second says how to plot them:\n\n```{r}\nggplot(dat, aes(y = mathach, x = ses)) + \n  geom_point( cex=0.5)\n```\n\nSo far, nothing too scary, right?\nThe `ggplot( dat, aes(x=mathach, y=ses) )` says \"My plot is going to use `dat` for my data, and my y-axis is the `mathach` variable and my x-axis is `ses`.\" The `aes()` bit is \"aesthetics\"--it is a way of tying variables to different kinds of things you could have on your plot: x location, y location, color, plotting symbol, and a few other things.\n\nFor example:\n\n```{r}\ndat <- dat |> \n  mutate(sector = factor(sector, levels=c(0,1), labels=c(\"public\",\"catholic\")),\n         minority = factor(minority, labels=c(\"non-minority\",\"minority\")))\n\nggplot( dat, aes(y=mathach, x=ses, col=sector, pch=minority) ) + \n  geom_point()\n```\n\nNote that `ggplot` wants the data frame to be neatly put together, including that categorical variables are listed as factors.\nThis is why we convert the dummy `sector` to a factor above.\nOnce you do this, however, it will label things in a nice way.\n\n\nYou can also automatically add various statistical summaries, such as simple regression lines:\n\n```{r}\nggplot( dat, aes(y=mathach, x=ses, col=sector ) ) + \n    geom_point() + \n    stat_smooth( method=\"lm\", se = FALSE )\n```\n\nNotice how it automatically realized you have two subgroups of data defined by sector.\nIt gives you a regression line for each group.\n\nThe elements of the plot are stacked, and if you remove one of the elements, it will not appear:\n\n```{r}\nggplot( dat, aes(y=mathach, x=ses, col=sector ) ) + \n  stat_smooth( method=\"lm\" )\n```\n\nHere we also added some uncertainty bars around the regression lines by not saying `se = FALSE`.\n(Including uncertainty is the default.)\n\n## Grouping\n\nCombining these ideas we can make a trend line for each school:\n\n```{r}\nmy.plot = ggplot( dat, aes(y=mathach, x=ses, col=sector, group=schoolid ) ) + \n    stat_smooth( method=\"lm\", se = FALSE )\n\nmy.plot\n```\n\nThe trendlines automatically extend to the limits of the data they are run on, hence the different lengths.\n\nAlso, notice we \"saved\" the plot in the variable `my.plot`.\nOnly when we \"print\" the plot will the plot appear on your display.\nWhen we type the name of a variable, it prints.\nOnce you have a plot stored in a variable you can augment it very easily.\n\nAs you may now realize, `ggplot2` is very, very powerful.\n\n## Customization\n\nWe next show some other things you can do.\nFor example, you can make lots of little plots:\n\n```{r}\nmy.plot + \n  facet_grid( ~ female ) + \n    ggtitle(\"School-level trend lines for their male and female students\") +\n    labs(x=\"SES\",y=\"Math Achievement\") \n```\n\nOr,\n\n```{r}\n# random subset of schoolid\nsch <- sample( unique( dat$schoolid ), 6 )\n\n# pipe into ggplot \nmy.six.plot <- dat |> \n  filter(schoolid %in% sch) |> \n  ggplot(aes(y=mathach, x=ses, col=sector ) ) + \n    facet_wrap( ~ schoolid, ncol=3 ) + \n    geom_point() + stat_smooth( method=\"lm\" )\n\nmy.six.plot\n```\n\nAlso shown are adding titles.\n\n## Themes\n\nYou can very quickly change the entire presentation of your plot using `themes`.\nThere are pre-packaged ones, and you can make your own that you use over and over.\nHere we set up a theme to be used moving forward\n\n```{r}\nlibrary( ggthemes )\nmy_t = theme_calc() + theme( legend.position=\"bottom\", \n                             legend.direction=\"horizontal\", \n                             legend.key.width=unit(1,\"cm\")  )\ntheme_set( my_t )\n```\n\nCompare the same plot from above, now with a new theme.\n\n```{r}\nmy.six.plot\n```\n\nCool, no?\n\n## Next steps\n\nThere is a lot of information out there on `ggplot` and my best advice is to find code examples, and then modify them as needed.\nThere are tutorials and blogs that walk through building plots (search for \"ggplot tutorial\" for example), but seeing examples seems to be the best way to learn the stuff.\nFor example, you could use the above code for your project one quite readily.\nAnd don't be afraid to ask how to modify plots on Piazza!\n\nIn particular, check out the excellent [\"R for Data Science'' textbook](http://r4ds.had.co.nz). It extensively uses ggplot, starting [here](http://r4ds.had.co.nz/data-visualisation.html).\n","srcMarkdownNoYaml":"\n\n```{r setup, include=FALSE}\nlibrary(lme4)\nlibrary(arm)\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(ggthemes)\n\nknitr::opts_chunk$set(echo = TRUE)\n```\n\nThis is a simple script demonstrating some powerful features of a plotting package `ggplot2`.\n\n`ggplot` can initially seem like a nightmare to some, but once you wrestle it to the ground it is one of the most powerful visualization tools you might have in your toolbox.\nHappily, it is fairly easy to get some basics up and running once you start looking at the world the way it does.\nLet's start doing that.\n\nFirst, `ggplot` thinks of a plot as a collection of layers stacked on top of each other.\nThe way this looks in code is a bunch of weird function calls connected together with `+`.\nYou read this series of calls left to right.\nThe first call is always a statement saying what data you are plotting and what variables you care about.\nSo before you can even plot, you need to make sure your data are in a nice, tidy data frame.\n\nHappily, when you load data, it usually is.\nFor example:\n\n```{r warning=FALSE}\ndat <- read_dta(\"data/hsb.dta\") |> \n  select(1:10)\n\nnames( dat )\n```\n\nThe easiest full plot to make has two elements.\nThe first gives what your variables are, and the second says how to plot them:\n\n```{r}\nggplot(dat, aes(y = mathach, x = ses)) + \n  geom_point( cex=0.5)\n```\n\nSo far, nothing too scary, right?\nThe `ggplot( dat, aes(x=mathach, y=ses) )` says \"My plot is going to use `dat` for my data, and my y-axis is the `mathach` variable and my x-axis is `ses`.\" The `aes()` bit is \"aesthetics\"--it is a way of tying variables to different kinds of things you could have on your plot: x location, y location, color, plotting symbol, and a few other things.\n\nFor example:\n\n```{r}\ndat <- dat |> \n  mutate(sector = factor(sector, levels=c(0,1), labels=c(\"public\",\"catholic\")),\n         minority = factor(minority, labels=c(\"non-minority\",\"minority\")))\n\nggplot( dat, aes(y=mathach, x=ses, col=sector, pch=minority) ) + \n  geom_point()\n```\n\nNote that `ggplot` wants the data frame to be neatly put together, including that categorical variables are listed as factors.\nThis is why we convert the dummy `sector` to a factor above.\nOnce you do this, however, it will label things in a nice way.\n\n## Summarizing\n\nYou can also automatically add various statistical summaries, such as simple regression lines:\n\n```{r}\nggplot( dat, aes(y=mathach, x=ses, col=sector ) ) + \n    geom_point() + \n    stat_smooth( method=\"lm\", se = FALSE )\n```\n\nNotice how it automatically realized you have two subgroups of data defined by sector.\nIt gives you a regression line for each group.\n\nThe elements of the plot are stacked, and if you remove one of the elements, it will not appear:\n\n```{r}\nggplot( dat, aes(y=mathach, x=ses, col=sector ) ) + \n  stat_smooth( method=\"lm\" )\n```\n\nHere we also added some uncertainty bars around the regression lines by not saying `se = FALSE`.\n(Including uncertainty is the default.)\n\n## Grouping\n\nCombining these ideas we can make a trend line for each school:\n\n```{r}\nmy.plot = ggplot( dat, aes(y=mathach, x=ses, col=sector, group=schoolid ) ) + \n    stat_smooth( method=\"lm\", se = FALSE )\n\nmy.plot\n```\n\nThe trendlines automatically extend to the limits of the data they are run on, hence the different lengths.\n\nAlso, notice we \"saved\" the plot in the variable `my.plot`.\nOnly when we \"print\" the plot will the plot appear on your display.\nWhen we type the name of a variable, it prints.\nOnce you have a plot stored in a variable you can augment it very easily.\n\nAs you may now realize, `ggplot2` is very, very powerful.\n\n## Customization\n\nWe next show some other things you can do.\nFor example, you can make lots of little plots:\n\n```{r}\nmy.plot + \n  facet_grid( ~ female ) + \n    ggtitle(\"School-level trend lines for their male and female students\") +\n    labs(x=\"SES\",y=\"Math Achievement\") \n```\n\nOr,\n\n```{r}\n# random subset of schoolid\nsch <- sample( unique( dat$schoolid ), 6 )\n\n# pipe into ggplot \nmy.six.plot <- dat |> \n  filter(schoolid %in% sch) |> \n  ggplot(aes(y=mathach, x=ses, col=sector ) ) + \n    facet_wrap( ~ schoolid, ncol=3 ) + \n    geom_point() + stat_smooth( method=\"lm\" )\n\nmy.six.plot\n```\n\nAlso shown are adding titles.\n\n## Themes\n\nYou can very quickly change the entire presentation of your plot using `themes`.\nThere are pre-packaged ones, and you can make your own that you use over and over.\nHere we set up a theme to be used moving forward\n\n```{r}\nlibrary( ggthemes )\nmy_t = theme_calc() + theme( legend.position=\"bottom\", \n                             legend.direction=\"horizontal\", \n                             legend.key.width=unit(1,\"cm\")  )\ntheme_set( my_t )\n```\n\nCompare the same plot from above, now with a new theme.\n\n```{r}\nmy.six.plot\n```\n\nCool, no?\n\n## Next steps\n\nThere is a lot of information out there on `ggplot` and my best advice is to find code examples, and then modify them as needed.\nThere are tutorials and blogs that walk through building plots (search for \"ggplot tutorial\" for example), but seeing examples seems to be the best way to learn the stuff.\nFor example, you could use the above code for your project one quite readily.\nAnd don't be afraid to ask how to modify plots on Piazza!\n\nIn particular, check out the excellent [\"R for Data Science'' textbook](http://r4ds.had.co.nz). It extensively uses ggplot, starting [here](http://r4ds.had.co.nz/data-visualisation.html).\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"pygments","output-file":"intro_ggplot.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"theme":"cosmo","code-copy":true,"title":"Intro to `ggplot`","author":"Luke Miratrix"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","highlight-style":"pygments","output-file":"intro_ggplot.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"documentclass":"scrreprt","title":"Intro to `ggplot`","author":"Luke Miratrix"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}