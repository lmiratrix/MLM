{"title":"`pivot_longer` and `pivot_wider`","markdown":{"yaml":{"title":"`pivot_longer` and `pivot_wider`","author":"Luke Miratrix and Josh Gilbert","editor":{"markdown":{"wrap":"sentence"}}},"headingText":"Converting wide data to long data","containsRefs":false,"markdown":"\n\n```{r setup_pivot_longer, include = FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(warning = FALSE)\nknitr::opts_chunk$set(message = FALSE)\n```\n\nGenerally, you want your data to be in a form where each row is a case and each column is a variable (either explanatory or response).\nSometimes your data don't start that way.\nThis section describes how to move your data around to get it in that form.\nThe tidyverse provides a simple method for doing this (`pivot_longer()` and `pivot_wider()`) which you should read about in R for Data Science.\nThere are also \"old school\" ways of doing this, via a method called `reshape()`; this way is more powerful and useful in some circumstances.\nSee the final section for more on this old-style approach.\n\nBut for now, the pivot methods will pretty much do everything you want.\nBoth `pivot_longer` and `pivot_wider` from `tidyverse` are great functions to understand.\nFirst, we load `tidyverse` and make some fake data.\n\n```{r}\nlibrary(tidyverse)\n\ndat <- data.frame( ID = c( 1:3 ), \n                  X = c( 10, 20, 30 ),\n                  Y1 = 1:3,\n                  Y2 = 10 + 1:3,\n                  Y3 = 20 + 1:3 )\n\ndat\n```\n\nThis data is in wide format, where we have multiple measurements (Y1, Y2, and Y3) for each individual (each row of data).\n\n\nWe use `pivot_longer` to take our `Y` values and nest them within each `ID` for longitudinal MLM analysis.\n(NB you can use SEM to fit longitudinal models with wide data; we do not explore that application here.)\n\n```{r}\ndatL <- pivot_longer(dat, Y1:Y3, \n                     names_to = \"time\", \n                     values_to = \"front\" )\n\ndatL\n\n\n\n```\n\n## Converting long data to wide data\n\n`pivot_wider` takes us back in the other direction.\n\n```{r}\nnewdat <- pivot_wider( datL, c(ID, X), \n                       names_from=time, \n                       values_from=front  )\n\nnewdat\n```\n\nWe then verify our work with a few checks.\n\n```{r}\nstopifnot( length( unique( newdat$ID ) ) == nrow( newdat ) )\n\nstudents = datL %>% dplyr::select( ID, X ) %>%\n    unique()\nstudents\n\nstudents = merge( students, newdat, by=\"ID\" )\n```\n\n## Optional: wrangling data with `reshape`\n\nThe `reshape()` command is the old-school way of doing things, and it is harder to use but also can be more powerful in some ways (alternatively, there is a long literature on doing fancy stuff with the pivot methods as well).\nThis section is entirely optional and possibly no longer useful.\n\nAnyway, say you have data in a form where a row has a value for a variable for several different points in time.\nThe following code turns it into a data.frame where each row (case) is a value for the variable at that point in time.\nYou also have an ID variable for which Country the GDP came from.\n\n```{r LoadDat}\ndtw = read.csv( \"data/fake_country_block.csv\", as.is=TRUE )\ndtw\n```\n\nHere we have three rows, but actually a lot of cases if we consider each time point a case.\nFor trying it on your own, get the sample csv file ()\\[here\\]\\\nSee the website to get the sample csv file \\\\verb\\|fake_country_block.csv\\|.\n\nThe following \\emph{reshapes} our original data by making a case for each time point:\n\n```{r GoToLong}\ndt = reshape( dtw, idvar=\"Country\", timevar=\"Year\", varying=2:9, sep=\"\", direction=\"long\" )\nhead(dt)\n```\n\nThings to notice: each case has a \"row name\" made out of the country and the Year.\nThe \"2:9\" indicates a range of columns for the variable that is actually the same variable.\\\nR picked up that, for each of these columns, \"X\" is the name of the variable and the number is the time, and seperated them.\nYou can set the name of your time variable, \\\\verb\\|timevar\\|, to whatever you want.\n\nThe above output is called \"long format\" and the prior is called \"wide format.\"\\\nYou can go in either direction.\nHere:\n\n```{r GoToWide}\ndtn = reshape( dt, idvar=\"Country\", timevar=\"Year\" )\ndtn\n```\n\nYou can reshape on multiple variables.\nFor example:\n\n```{r ReshapeExpDat}\nexp.dat = data.frame( ID=c(\"a\",\"b\",\"c\",\"d\"), \n      cond = c(\"AI\",\"DI\",\"DI\",\"AI\"),\n\t\t\ttrial1 = c(\"E\",\"U\",\"U\",\"E\"),\n\t\t\tdec1 = c(1,1,0,1),\n\t\t\ttrial2 = c(\"U\",\"E\",\"U\",\"E\"),\n\t\t\tdec2 = c(0,0,0,1),\n\t\t\t\ttrial3 = c(\"U\",\"E\",\"E\",\"U\"),\n\t\t\tdec3 = c(0,1,0,1),\n\t\t\t\ttrial4 = c(\"E\",\"U\",\"E\",\"U\"),\n\t\t\tdec4 = c(0,1,0,0) )\nexp.dat\nrs = reshape( exp.dat,  idvar=\"ID\", \n  \t\tvarying=c( 3:10 ), sep=\"\", direction=\"long\")\t\t\t\nhead(rs)\n```\n\nIt sorts out which variables are which.\nNote the names have to be exactly the same for any group of variables.\n\nOnce you have reshaped, you can look at things more easily (I use mosaic's tally instead of the base table):\n\n```{r TableDat}\nmosaic::tally( trial ~ dec, data=rs )\n```\n\nor\n\n```{r TwoWayTable}\nmosaic::tally( trial~dec+cond, data=rs )\n```\n","srcMarkdownNoYaml":"\n\n```{r setup_pivot_longer, include = FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(warning = FALSE)\nknitr::opts_chunk$set(message = FALSE)\n```\n\nGenerally, you want your data to be in a form where each row is a case and each column is a variable (either explanatory or response).\nSometimes your data don't start that way.\nThis section describes how to move your data around to get it in that form.\nThe tidyverse provides a simple method for doing this (`pivot_longer()` and `pivot_wider()`) which you should read about in R for Data Science.\nThere are also \"old school\" ways of doing this, via a method called `reshape()`; this way is more powerful and useful in some circumstances.\nSee the final section for more on this old-style approach.\n\nBut for now, the pivot methods will pretty much do everything you want.\nBoth `pivot_longer` and `pivot_wider` from `tidyverse` are great functions to understand.\nFirst, we load `tidyverse` and make some fake data.\n\n```{r}\nlibrary(tidyverse)\n\ndat <- data.frame( ID = c( 1:3 ), \n                  X = c( 10, 20, 30 ),\n                  Y1 = 1:3,\n                  Y2 = 10 + 1:3,\n                  Y3 = 20 + 1:3 )\n\ndat\n```\n\nThis data is in wide format, where we have multiple measurements (Y1, Y2, and Y3) for each individual (each row of data).\n\n## Converting wide data to long data\n\nWe use `pivot_longer` to take our `Y` values and nest them within each `ID` for longitudinal MLM analysis.\n(NB you can use SEM to fit longitudinal models with wide data; we do not explore that application here.)\n\n```{r}\ndatL <- pivot_longer(dat, Y1:Y3, \n                     names_to = \"time\", \n                     values_to = \"front\" )\n\ndatL\n\n\n\n```\n\n## Converting long data to wide data\n\n`pivot_wider` takes us back in the other direction.\n\n```{r}\nnewdat <- pivot_wider( datL, c(ID, X), \n                       names_from=time, \n                       values_from=front  )\n\nnewdat\n```\n\nWe then verify our work with a few checks.\n\n```{r}\nstopifnot( length( unique( newdat$ID ) ) == nrow( newdat ) )\n\nstudents = datL %>% dplyr::select( ID, X ) %>%\n    unique()\nstudents\n\nstudents = merge( students, newdat, by=\"ID\" )\n```\n\n## Optional: wrangling data with `reshape`\n\nThe `reshape()` command is the old-school way of doing things, and it is harder to use but also can be more powerful in some ways (alternatively, there is a long literature on doing fancy stuff with the pivot methods as well).\nThis section is entirely optional and possibly no longer useful.\n\nAnyway, say you have data in a form where a row has a value for a variable for several different points in time.\nThe following code turns it into a data.frame where each row (case) is a value for the variable at that point in time.\nYou also have an ID variable for which Country the GDP came from.\n\n```{r LoadDat}\ndtw = read.csv( \"data/fake_country_block.csv\", as.is=TRUE )\ndtw\n```\n\nHere we have three rows, but actually a lot of cases if we consider each time point a case.\nFor trying it on your own, get the sample csv file ()\\[here\\]\\\nSee the website to get the sample csv file \\\\verb\\|fake_country_block.csv\\|.\n\nThe following \\emph{reshapes} our original data by making a case for each time point:\n\n```{r GoToLong}\ndt = reshape( dtw, idvar=\"Country\", timevar=\"Year\", varying=2:9, sep=\"\", direction=\"long\" )\nhead(dt)\n```\n\nThings to notice: each case has a \"row name\" made out of the country and the Year.\nThe \"2:9\" indicates a range of columns for the variable that is actually the same variable.\\\nR picked up that, for each of these columns, \"X\" is the name of the variable and the number is the time, and seperated them.\nYou can set the name of your time variable, \\\\verb\\|timevar\\|, to whatever you want.\n\nThe above output is called \"long format\" and the prior is called \"wide format.\"\\\nYou can go in either direction.\nHere:\n\n```{r GoToWide}\ndtn = reshape( dt, idvar=\"Country\", timevar=\"Year\" )\ndtn\n```\n\nYou can reshape on multiple variables.\nFor example:\n\n```{r ReshapeExpDat}\nexp.dat = data.frame( ID=c(\"a\",\"b\",\"c\",\"d\"), \n      cond = c(\"AI\",\"DI\",\"DI\",\"AI\"),\n\t\t\ttrial1 = c(\"E\",\"U\",\"U\",\"E\"),\n\t\t\tdec1 = c(1,1,0,1),\n\t\t\ttrial2 = c(\"U\",\"E\",\"U\",\"E\"),\n\t\t\tdec2 = c(0,0,0,1),\n\t\t\t\ttrial3 = c(\"U\",\"E\",\"E\",\"U\"),\n\t\t\tdec3 = c(0,1,0,1),\n\t\t\t\ttrial4 = c(\"E\",\"U\",\"E\",\"U\"),\n\t\t\tdec4 = c(0,1,0,0) )\nexp.dat\nrs = reshape( exp.dat,  idvar=\"ID\", \n  \t\tvarying=c( 3:10 ), sep=\"\", direction=\"long\")\t\t\t\nhead(rs)\n```\n\nIt sorts out which variables are which.\nNote the names have to be exactly the same for any group of variables.\n\nOnce you have reshaped, you can look at things more easily (I use mosaic's tally instead of the base table):\n\n```{r TableDat}\nmosaic::tally( trial ~ dec, data=rs )\n```\n\nor\n\n```{r TwoWayTable}\nmosaic::tally( trial~dec+cond, data=rs )\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"pygments","output-file":"pivot_wider.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"theme":"cosmo","code-copy":true,"title":"`pivot_longer` and `pivot_wider`","author":"Luke Miratrix and Josh Gilbert"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","highlight-style":"pygments","output-file":"pivot_wider.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"output_dir":"docs","editor":{"markdown":{"wrap":"sentence"}},"documentclass":"scrreprt","title":"`pivot_longer` and `pivot_wider`","author":"Luke Miratrix and Josh Gilbert"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}