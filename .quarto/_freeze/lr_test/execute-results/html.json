{
  "hash": "6c08f1f693158afcd135a1e39fbf0c36",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Likelihood Ratio Tests\"\nauthor: \"Josh Gilbert\"\neditor: \n  markdown: \n    wrap: sentence\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n## R Setup\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(haven)\nlibrary(sjPlot)\n\n# clear memory\nrm(list = ls())\n\nselect <- dplyr::select\n\n# load HSB data\nhsb <- read_dta(\"data/hsb.dta\") |> \n  select(mathach, ses, schoolid)\n```\n:::\n\n\n\n\n\n\n## Why LR Tests?\n\nOur fixed effects coefficients have SEs, z-statistics, and p-values, which allow us to easily test the null hypothesis that the slopes are 0 in the population.\nNo such quantities, however, are provided for the random effects of our model.\nWe can use LR tests to address this issue and test the statistical significance of the various random portions of our model.\n\nWe can also use LR tests on fixed effects or sets of fixed effects (like a nested F-test in OLS), but 99.9% of the time, the conclusion will be the same as using the z-statistics.\n\nLR tests require that the models are *nested*, meaning that they use the same data, and one model can be expressed as a constrained version of the other.\n\n## HSB Example\n\nWe fit 3 models:\n\n1.  Random intercept model\n2.  Random slope model\n3.  Random slope model with no correlation between intercepts and slopes\n\nWe can see from the model output that the point estimates for the random slope variance $\\tau_{11}$ and the correlation $\\rho_{01}$ are non-zero, but how can we get p-values for these quantities?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lmer(mathach ~ ses + (1|schoolid), hsb)\nm2 <- lmer(mathach ~ ses + (ses|schoolid), hsb)\nm3 <- lmer(mathach ~ ses + (ses||schoolid), hsb)\n\ntab_model(m1, m2, m3,\n          p.style = \"stars\",\n          show.se = TRUE,\n          show.ci = FALSE,\n          dv.labels = c(\"RI\", \"RS\", \"No Rho\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"2\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">RI</th>\n<th colspan=\"2\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">RS</th>\n<th colspan=\"2\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">No Rho</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">std. Error</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">std. Error</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7\">std. Error</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">(Intercept)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">12.66 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.19</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">12.67 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.19</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">12.65 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7\">0.19</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">ses</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.39 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.11</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.39 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.12</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">2.40 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7\">0.12</td>\n</tr>\n<tr>\n<td colspan=\"7\" style=\"font-weight:bold; text-align:left; padding-top:.8em;\">Random Effects</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&sigma;<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">37.03</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">36.83</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">36.82</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>00</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">4.77 <sub>schoolid</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">4.83 <sub>schoolid</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">4.85 <sub>schoolid</sub></td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>11</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">&nbsp;</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.41 <sub>schoolid.ses</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.42 <sub>schoolid.ses</sub></td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&rho;<sub>01</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">&nbsp;</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">-0.11 <sub>schoolid</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">&nbsp;</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">ICC</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.11</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.12</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.12</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">N</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">160 <sub>schoolid</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">160 <sub>schoolid</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">160 <sub>schoolid</sub></td>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"2\">7185</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"2\">7185</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"2\">7185</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">Marginal R<sup>2</sup> / Conditional R<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.077 / 0.182</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.077 / 0.189</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"2\">0.077 / 0.185</td>\n</tr>\n<tr>\n<td colspan=\"7\" style=\"font-style:italic; border-top:double black; text-align:right;\">* p&lt;0.05&nbsp;&nbsp;&nbsp;** p&lt;0.01&nbsp;&nbsp;&nbsp;*** p&lt;0.001</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n\n### Are random `ses` slopes necessary?\n\nWe use `anova` to perform the LR test comparing `m1` and `m2`, and we see that the random slopes are not statistically significant.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(m1, m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nData: hsb\nModels:\nm1: mathach ~ ses + (1 | schoolid)\nm2: mathach ~ ses + (ses | schoolid)\n   npar   AIC   BIC logLik deviance  Chisq Df Pr(>Chisq)\nm1    4 46649 46677 -23320    46641                     \nm2    6 46648 46690 -23318    46636 4.5354  2     0.1035\n```\n\n\n:::\n:::\n\n\n\n\n\n\n### Is there a correlation between the random intercept and slope for `ses`?\n\nSimilarly, we see that the correlation is non-significant\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(m2, m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nData: hsb\nModels:\nm3: mathach ~ ses + ((1 | schoolid) + (0 + ses | schoolid))\nm2: mathach ~ ses + (ses | schoolid)\n   npar   AIC   BIC logLik deviance  Chisq Df Pr(>Chisq)\nm3    5 46647 46681 -23318    46637                     \nm2    6 46648 46690 -23318    46636 0.2762  1     0.5992\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Technical Notes\n\nTL/DR: The traditional LR test provided by `anova` is likely to be conservative for testing the significance of variance components.\nFor the purposes of this course, it is fine.\n\nThere is a lot of multilevel literature arguing that testing a null hypothesis on variance components with LR tests is not the best approach.\nThe reason is that variances cannot be negative, so the null hypothesis exists on the \"boundary of the parameter space\" and therefore is \"likely to be conservative\" (to use the warning that Stata gives you, i.e., the p-values are too high).\nThe true distribution of a 0 variance component is not a normal distribution, but a mixture distribution with half of the probability mass at 0 and the other half $\\chi^2$.\nWhen you're testing the significance of the random intercepts model, you can divide the p-value by 2 to get the right answer (Stata default), though for more complex models it's not so simple.\nThere are some R packages that use simulation-based approaches to provide more robust results such as `pbkrtest::PBmodcomp`, but we won't go into them here.\nSee RH&S pp. 88-89 for a more thorough discussion of this issue.\nDespite this, the standard LR test remains common in practice.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}