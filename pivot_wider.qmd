---
title: "`pivot_longer` and `pivot_wider`"
author: "Luke Miratrix and Josh Gilbert"
editor: 
  markdown: 
    wrap: sentence
---

```{r, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
```

`pivot_longer` and `pivot_wider` from `tidyverse` are great functions to understand.
First, we load `tidyverse` and make some fake data.

```{r}
library(tidyverse)

dat <- data.frame( ID = c( 1:3 ), 
                  X = c( 10, 20, 30 ),
                  Y1 = 1:3,
                  Y2 = 10 + 1:3,
                  Y3 = 20 + 1:3 )

dat
```

We use `pivot_longer` to take our `Y` values (imagine these as three measurements) and nest them within each `ID` for longitudinal MLM analysis. (NB you can use SEM to fit longitudinal models with wide data; we do not explore the application here.)

`pivot_wider` takes us back in the other direction.

We then verify our work with a few checks.

```{r}
datL <- pivot_longer(dat, Y1:Y3, 
                     names_to = "time", 
                     values_to = "front" )

datL

newdat <- pivot_wider( datL, c(ID, X), 
                       names_from=time, 
                       values_from=front  )

newdat

stopifnot( length( unique( newdat$ID ) ) == nrow( newdat ) )


datL

students = datL %>% dplyr::select( ID, X ) %>%
    unique()

students

students = merge( students, newdat, by="ID" )

```
